- name: Copy updated IP to local directory
  local_action:
    module: template
    src: metallb-ipaddresspool.yaml.j2
    dest: ../manifest/overlays/production/metallb-ipaddresspool.yaml
  register: ip_pool_template

- name: Git push updated IP if changed
  local_action:
    module: shell
    cmd: |
      git add metallb-ipaddresspool.yaml \
      && git commit -m "ANSIBLE BOOTSTRAP: update IP pool to reflect new VPS" \
      && git push origin main
    chdir:
      ../manifest/overlays/production
  when: ip_pool_template.changed
