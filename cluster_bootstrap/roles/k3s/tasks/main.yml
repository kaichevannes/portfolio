- name: Ensure ufw is installed
  become: true
  package:
    name: ufw
    state: present

- name: Open required firewall ports
  become: true
  shell: |
    ufw allow 6443/tcp #apiserver
    ufw allow from 10.42.0.0/16 to any #pods
    ufw allow from 10.43.0.0/16 to any #services

- name: Install k3s
  shell: curl -sfL https://get.k3s.io | sh -
  args:
    creates: /etc/rancher/k3s/k3s.yaml
